import shutil
import hashlib
import requests
import tarfile

ARCHIVE_NAME = '66b6d135a7e86758803a93f20f6fd7171a7d8e45.tar.gz'
FILENAMES = ['dashlame.pyc', 'wordlist.txt']
FILE_DIGESTS = ['2355e6acb984433fea0e1a916cdb1ce0ebc7daa0','759f2e3939fa6ecb20c8bb772af5ae8cc1a2004c']

def sha1(fname):
    hash_sha1 = hashlib.sha1()
    with open(fname, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha1.update(chunk)
    return hash_sha1.hexdigest()

r = requests.get('https://static.ctf.insecurity-insa.fr/'+ARCHIVE_NAME, stream=True)

if r.status_code == 200:
    with open(ARCHIVE_NAME, 'wb') as f:
        r.raw.decode_content = True
        shutil.copyfileobj(r.raw, f)
        
tar = tarfile.open(ARCHIVE_NAME)
tar.extractall()
tar.close()

print('Exploit OK' if all(sha1(filename) == digest for filename, digest in zip(FILENAMES, FILE_DIGESTS)) else 'Exploit error')
