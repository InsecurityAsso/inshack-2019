import shutil
import hashlib
import requests
import tarfile

ARCHIVE_NAME = '80b4175896560b143276d9ca5aa3e39a8ac4f613.tar.gz'
FILENAMES = ['output.txt', 'yarsac.py']
FILE_DIGESTS = ['82d28b55de7a0a68efbdbb7411e835f4d0109f34','f8cb9145a816450fc5d4fabf50f74d90e6e1deaf']

def sha1(fname):
    hash_sha1 = hashlib.sha1()
    with open(fname, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha1.update(chunk)
    return hash_sha1.hexdigest()

r = requests.get('https://static.ctf.insecurity-insa.fr/'+ARCHIVE_NAME, stream=True)

if r.status_code == 200:
    with open(ARCHIVE_NAME, 'wb') as f:
        r.raw.decode_content = True
        shutil.copyfileobj(r.raw, f)
        
tar = tarfile.open(ARCHIVE_NAME)
tar.extractall()
tar.close()

print('Exploit OK' if all(sha1(filename) == digest for filename, digest in zip(FILENAMES, FILE_DIGESTS)) else 'Exploit error')
