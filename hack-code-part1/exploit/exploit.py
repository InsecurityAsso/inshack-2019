import requests
import os

if os.getenv("DEV") == "1":
    SERVER_URL = 'http://localhost:4321'
else:
    SERVER_URL = 'https://hack-code.ctf.insecurity-insa.fr'
auth = ("insecurity", "fake_preprod_password")

with open('sol126.txt', 'rb') as fi:
    taps = fi.read().strip()

#Check homepage is ok
assert 'Enter router IDs' in requests.get(SERVER_URL, auth=auth).text

#Check routes.txt is available
assert requests.get(SERVER_URL+'/static/routes.txt', auth=auth).text.startswith('e5a10f35,3514c407,c4eb2a08,9ab8a703,c48ecbc5,cbd85052,d7d3fe6d,cefca924,100284b7\n')

#Check we get 4 flags for 'optimal' solution
assert requests.post(SERVER_URL + '/submit', data={'taps':taps}, auth=auth).text.count('INSA{') == 4

print('Exploit OK')
