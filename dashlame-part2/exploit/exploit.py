import shutil
import hashlib
import requests
import tarfile

ARCHIVE_NAME = '11c0fb2a76b074bfa78516cde464cdc9d8cf0eb4.tar.gz'
FILENAMES = ['admin.dla']
FILE_DIGESTS = ['f533bd019480ab8cfd80ed9b10541baaa1415f4d']

def sha1(fname):
    hash_sha1 = hashlib.sha1()
    with open(fname, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha1.update(chunk)
    return hash_sha1.hexdigest()

r = requests.get('https://static.ctf.insecurity-insa.fr/'+ARCHIVE_NAME, stream=True)

if r.status_code == 200:
    with open(ARCHIVE_NAME, 'wb') as f:
        r.raw.decode_content = True
        shutil.copyfileobj(r.raw, f)
        
tar = tarfile.open(ARCHIVE_NAME)
tar.extractall()
tar.close()

print('Exploit OK' if all(sha1(filename) == digest for filename, digest in zip(FILENAMES, FILE_DIGESTS)) else 'Exploit error')
