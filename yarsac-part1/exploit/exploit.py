import shutil
import hashlib
import requests
import tarfile

ARCHIVE_NAME = '595437e42ea3951e8ed4ecda16141f017f3ba36b.tar.gz'
FILENAMES = ['output.txt', 'yarsac.py']
FILE_DIGESTS = ['aef688e82161bfca3676343853b9fa373ff0fdbc','7d4106641f782288580ef6bc87834c540cc1a7ab']

def sha1(fname):
    hash_sha1 = hashlib.sha1()
    with open(fname, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_sha1.update(chunk)
    return hash_sha1.hexdigest()

r = requests.get('https://static.ctf.insecurity-insa.fr/'+ARCHIVE_NAME, stream=True)

if r.status_code == 200:
    with open(ARCHIVE_NAME, 'wb') as f:
        r.raw.decode_content = True
        shutil.copyfileobj(r.raw, f)
        
tar = tarfile.open(ARCHIVE_NAME)
tar.extractall()
tar.close()

print('Exploit OK' if all(sha1(filename) == digest for filename, digest in zip(FILENAMES, FILE_DIGESTS)) else 'Exploit error')
