import sys
import gzip
import mmap
import base64
import pathlib
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('fs_img_path', type=pathlib.Path)
args = parser.parse_args()
with args.fs_img_path.open('rb') as img:
    mm = mmap.mmap(img.fileno(), 0, prot=mmap.PROT_READ)
    start_gz = mm.find('-BGZ-'.encode('utf-16-le')) + 10
    end_gz = mm.find('-EGZ-'.encode('utf-16-le'))
    if start_gz == -1 or end_gz == -1:
        raise RuntimeError("Failed to find markers!")
    data = gzip.decompress(base64.b64decode(mm[start_gz:end_gz].decode('utf-16-le')))
    sys.stdout.buffer.write(data)
